<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualizing subclonal expansions • mobster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualizing subclonal expansions">
<meta property="og:description" content="">
<meta property="og:image" content="caravagn.github.io/mobster/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mobster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/mobster.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Example_tumour_simulation.html">Visualizing subclonal expansions</a>
    </li>
    <li>
      <a href="../articles/bootstrap.html">Confidence estimation via the bootstrap</a>
    </li>
    <li>
      <a href="../articles/dnds.html">dN/dS statistics for mobster fits</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting mobster fits</a>
    </li>
    <li>
      <a href="../articles/popgen.html">Population Genetics statistics for mobster fits</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Visualizing subclonal expansions</h1>
                        <h4 class="author">Giulio Caravagna and Marc Williams</h4>
            
            <h4 class="date">February 2019</h4>
      
      
      <div class="hidden name"><code>Example_tumour_simulation.Rmd</code></div>

    </div>

    
    
<p>Stochastic branching processes models of tumour growth describe cell division processes and the propagation of somatic alleles that accrue during tumour evolution.</p>
<p>In this RMarkdown, we use these population genetics models to visualise the joint effects of <em>neutral evolution</em> and <em>positive selection</em> on sequencing data of tumour’s Variant Allele Frequencies (VAFs).</p>
<p>You can generate similar dynamics using the <a href="https://t-heide.github.io/TEMULATOR">Tumour Emulator (TEMULATOR)</a> available at the <a href="http://www.sottorivalab.org/">Sottoriva Lab</a>.</p>
<div id="simulated-tumour-growth" class="section level1">
<h1 class="hasAnchor">
<a href="#simulated-tumour-growth" class="anchor"></a>Simulated tumour growth</h1>
<p>We have simulated a tumour with 2 clones. The tumours starts with the ancestral clone at time <code>t = 0</code>, and the subclone with increased positive selection relative to its ancestor (<span class="math inline">\(s&gt;0\)</span>), emerging at time <code>t = 9</code>.</p>
<p>We load the simulation object <a href="./simulationdata.Rdata">simulationdata.Rdata</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(mobster)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(tibble)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># Load input data from Marc</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="st">'simulationdata.Rdata'</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># Split by time point (`d` variable)</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">df.steps =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/split.html">split</a></span>(df, <span class="dt">f =</span> df<span class="op">$</span>d)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># Integer times</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">t_integers =<span class="st"> </span>df<span class="op">$</span>d <span class="op">%&gt;%</span><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>unique <span class="op">%&gt;%</span><span class="st"> </span>sort </a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">df =<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(d <span class="op">%in%</span><span class="st"> </span>t_integers) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">cloneid =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(cloneid)) </a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(df <span class="op">%&gt;%</span><span class="st"> </span>as_tibble)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; # A tibble: 70,474 x 6</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt;      VAF trueVAF cloneid cloneVAF     d popsize</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt;  1 0.496     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt;  2 0.459     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt;  3 0.496     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt;  4 0.5       0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt;  5 0.463     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt;  6 0.460     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">#&gt;  7 0.484     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="co">#&gt;  8 0.474     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="co">#&gt;  9 0.491     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">#&gt; 10 0.505     0.5 1              0     1       1</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">#&gt; # … with 70,464 more rows</span></a></code></pre></div>
<p>We first use <code>gganimate</code> to create a GIF of the simulated data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ani =<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>()  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">cloneid =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(cloneid)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> VAF, <span class="dt">fill =</span> cloneid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span>gganimate<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gganimate/man/transition_states.html">transition_states</a></span>(</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    d,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="dt">transition_length =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="dt">state_length =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">  </span>gganimate<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gganimate/man/ease_aes.html">ease_aes</a></span>(<span class="st">'cubic-in-out'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Counts (number of mutations)"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    <span class="dt">title =</span> <span class="st">'Simulated VAF distribution'</span>,</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">    <span class="dt">subtitle =</span> <span class="st">'Tumour doublings (clock): t = {closest_state}'</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggthemes/man/scale_ptol.html">scale_fill_ptol</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="st">  </span>CNAqc<span class="op">:::</span><span class="kw">my_ggplot_theme</span>() </a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">  gganimate<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gganimate/man/animate.html">animate</a></span>(ani,</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">                   <span class="dt">width =</span> <span class="dv">480</span>,</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">                   <span class="dt">height =</span> <span class="dv">480</span>,</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">                   <span class="dt">renderer =</span> gganimate<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gganimate/man/renderers.html">magick_renderer</a></span>())</a></code></pre></div>
<p><img src="Example_tumour_simulation_files/figure-html/unnamed-chunk-3-1.gif"><!-- --></p>
<p>The time units of the plot are <em>genome doublings</em>. We have simulate Poisson-distributed <em>whole-genome sequencing</em> (WGS) data at <code>120x</code> median depth, and perfect tumour purity (<code>100%</code>). These parameters affect the observable dynamics; here the subclone is visible after <code>t = 14</code> doublings, and sweeps completely at <code>t = 19</code>.</p>
<p>We can plot the data distribution at each of a discrete set of time-points.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> VAF, <span class="dt">fill =</span> cloneid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>( <span class="op">~</span><span class="st"> </span>d, <span class="dt">nrow =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">             <span class="dt">linetype =</span> <span class="st">'dashed'</span>,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">             <span class="dt">size =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="dt">title =</span> <span class="st">'Snapshots of tumour growth with positive subclonal selection dynamics'</span>, </a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="dt">y =</span> <span class="st">"Counts"</span>, </a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    <span class="dt">x =</span> <span class="st">'Simulated VAF'</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  </span>CNAqc<span class="op">:::</span><span class="kw">my_ggplot_theme</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggthemes/man/scale_ptol.html">scale_fill_ptol</a></span>()</a></code></pre></div>
<p><img src="Example_tumour_simulation_files/figure-html/unnamed-chunk-4-1.png" width="1344"> WGS data are simulated independently at each time-point, and the VAFs at each point are therefore uncorrelated. The monoclonal ancestral population is dark blue; mutations in the new subclone plus the hitchikkers are coloured in purple.</p>
<p>The dynamics of the tumour span from time <code>t=0</code> to <code>t=23</code>; the subclone is undetectable before <code>t=14</code>, and has sweeped through at the end of the simulation.</p>
</div>
<div id="mobster-fits" class="section level1">
<h1 class="hasAnchor">
<a href="#mobster-fits" class="anchor"></a>MOBSTER fits</h1>
<p>We capture the dynamics (fit and plot) with a snapshot function <code>snap</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">snap =<span class="st"> </span><span class="cf">function</span>(data, t, ...)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  x =<span class="st"> </span>data[[t]]</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  x =<span class="st"> </span>x[x<span class="op">$</span>VAF <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.05</span>,]</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  time_label =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'t_0 = '</span>, x<span class="op">$</span>d[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="co"># Ellipsis to get what fits we want</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  f =<span class="st"> </span><span class="kw"><a href="../reference/mobster_fit.html">mobster_fit</a></span>(x, <span class="dt">description =</span> time_label, ...)<span class="op">$</span>best</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">fit =</span> f, <span class="dt">plot =</span> <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(f) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="dt">title =</span> time_label)))</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co"># Initial clone (monoclonal)</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">initiation =<span class="st"> </span><span class="kw">snap</span>(<span class="dt">data =</span> df.steps, <span class="dt">t =</span> <span class="dv">5</span>, <span class="dt">K =</span> <span class="dv">1</span>, <span class="dt">samples =</span> <span class="dv">1</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  [ MOBSTER fit ]</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; ✔ Loaded input data, n = 2151.</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; ❯ n = 2151. Mixture with k = 1 Beta(s). Pareto tail: TRUE and FALSE. Output clusters with π &gt; 0.02 and n &gt; 10.</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; ❯ Custom fit by Moments-matching in up to 250 steps, with ε = 1e-10 and peaks initialisation.</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; ❯ Scoring (without parallel) 1 x 1 x 2 = 2 models by reICL.</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; ℹ MOBSTER fits completed in 761ms.</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; ── [ MOBSTER ] t_0 = 3 n = 2151 with k = 1 Beta(s) and a tail ───────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; ● Clusters: π = 56% [Tail] and 44% [C1], with π &gt; 0.</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; ● Tail [n = 1156, 56%] with alpha = 1.2.</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; ● Beta C1 [n = 995, 44%] with mean = 0.5.</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; ℹ Score(s): NLL = -1885.56; ICL = -3543.5 (-3725.09), H = 181.58 (0). Fit converged by MM in 21 steps.</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co"># Ongoing subclonal expansion (polyclonal)</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">selection =<span class="st">  </span><span class="kw">snap</span>(<span class="dt">data =</span> df.steps, <span class="dt">t =</span> <span class="dv">34</span>, <span class="dt">K =</span> <span class="dv">2</span>, <span class="dt">samples =</span> <span class="dv">1</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt;  [ MOBSTER fit ]</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt; ✔ Loaded input data, n = 3449.</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt; ❯ n = 3449. Mixture with k = 2 Beta(s). Pareto tail: TRUE and FALSE. Output clusters with π &gt; 0.02 and n &gt; 10.</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt; ❯ Custom fit by Moments-matching in up to 250 steps, with ε = 1e-10 and peaks initialisation.</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; ❯ Scoring (without parallel) 1 x 1 x 2 = 2 models by reICL.</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; ℹ MOBSTER fits completed in 11.7s.</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; ── [ MOBSTER ] t_0 = 17.5 n = 3449 with k = 2 Beta(s) and a tail ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt; ● Clusters: π = 49% [C2], 26% [Tail] and 25% [C1], with π &gt; 0.</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co">#&gt; ● Tail [n = 805, 26%] with alpha = 1.2.</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">#&gt; ● Beta C1 [n = 967, 25%] with mean = 0.51.</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">#&gt; ● Beta C2 [n = 1677, 49%] with mean = 0.33.</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co">#&gt; ℹ Score(s): NLL = -2141.73; ICL = -3177.64 (-3783.57), H = 1032.51 (426.58). Fit interrupted by MM in 250 steps.</span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="co"># Sweeped clone (monoclonal)</span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44">sweep =<span class="st">  </span><span class="kw">snap</span>(<span class="dt">data =</span> df.steps, <span class="dt">t =</span> <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(df.steps), <span class="dt">K =</span> <span class="dv">1</span>, <span class="dt">samples =</span> <span class="dv">1</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="co">#&gt;  [ MOBSTER fit ]</span></a>
<a class="sourceLine" id="cb4-46" data-line-number="46"><span class="co">#&gt; ✔ Loaded input data, n = 4001.</span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47"><span class="co">#&gt; ❯ n = 4001. Mixture with k = 1 Beta(s). Pareto tail: TRUE and FALSE. Output clusters with π &gt; 0.02 and n &gt; 10.</span></a>
<a class="sourceLine" id="cb4-48" data-line-number="48"><span class="co">#&gt; ❯ Custom fit by Moments-matching in up to 250 steps, with ε = 1e-10 and peaks initialisation.</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="co">#&gt; ❯ Scoring (without parallel) 1 x 1 x 2 = 2 models by reICL.</span></a>
<a class="sourceLine" id="cb4-50" data-line-number="50"><span class="co">#&gt; ℹ MOBSTER fits completed in 954ms.</span></a>
<a class="sourceLine" id="cb4-51" data-line-number="51"><span class="co">#&gt; ── [ MOBSTER ] t_0 = 23 n = 4001 with k = 1 Beta(s) and a tail ──────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb4-52" data-line-number="52"><span class="co">#&gt; ● Clusters: π = 60% [C1] and 40% [Tail], with π &gt; 0.</span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53"><span class="co">#&gt; ● Tail [n = 1530, 40%] with alpha = 1.1.</span></a>
<a class="sourceLine" id="cb4-54" data-line-number="54"><span class="co">#&gt; ● Beta C1 [n = 2471, 60%] with mean = 0.49.</span></a>
<a class="sourceLine" id="cb4-55" data-line-number="55"><span class="co">#&gt; ℹ Score(s): NLL = -3417.33; ICL = -6427.2 (-6784.89), H = 357.69 (0). Fit converged by MM in 28 steps.</span></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"></a>
<a class="sourceLine" id="cb4-57" data-line-number="57">cowplot<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(initiation<span class="op">$</span>plot, selection<span class="op">$</span>plot, sweep<span class="op">$</span>plot, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="Example_tumour_simulation_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
<p>Notice that the tail at the end of the simulation is now mostly dominated by the progeny of the most recent clone, and the amount of mutations in the tail and the clonal cluster is balanced as in the beginning of the simulation. This because in this simulation the mutation rate of the tumour is the same across all simulated clones.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulated-tumour-growth">Simulated tumour growth</a></li>
      <li><a href="#mobster-fits">MOBSTER fits</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://sites.google.com/site/giuliocaravagna/">Giulio Caravagna</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
